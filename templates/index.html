<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SMARTCONTROL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon.ico') }}">
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

    <header class="bg-blue-700 text-white shadow-md p-4 flex items-center justify-between no-print">
        <div class="flex items-center gap-4">
            <img id="header-logo" src="" alt="Logótipo" class="h-8 hidden">
            <div>
                <h1 id="header-company-name" class="text-2xl font-bold tracking-wide">SMARTCONTROL</h1>
                <p id="header-company-cnpj" class="text-xs"></p>
            </div>
        </div>
        <nav>
            <ul class="flex gap-4 text-sm">
                <li><a href="#" class="hover:text-blue-200 transition-colors">Início</a></li>
                <li><a href="#" class="hover:text-blue-200 transition-colors">Sobre</a></li>
                <li><a href="#" class="hover:text-blue-200 transition-colors">Ajuda</a></li>
            </ul>
        </nav>
    </header>

    <main class="flex-grow container mx-auto px-4 py-6">
        
        <div id="login-screen" class="fixed inset-0 bg-gray-100 flex items-center justify-center z-50">
            <div class="w-full max-w-sm p-8 bg-white rounded-xl shadow-lg">
                <h1 class="text-3xl font-bold text-gray-800 text-center mb-2">Login</h1>
                <p class="text-center text-gray-500 mb-6">Acesse o sistema de controle de ativos.</p>
                <form id="login-form">
                    <div class="mb-4"><label for="username" class="block text-sm font-medium text-gray-700">Utilizador</label><input type="text" id="username" class="mt-1 w-full border-gray-300 rounded-lg shadow-sm" required></div>
                    <div class="mb-6"><label for="password" class="block text-sm font-medium text-gray-700">Senha</label><input type="password" id="password" class="mt-1 w-full border-gray-300 rounded-lg shadow-sm" required></div>
                    <p id="login-error" class="text-red-500 text-sm text-center mb-4 hidden"></p>
                    <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700">Entrar</button>
                </form>
            </div>
        </div>

        <div id="app-content" class="max-w-7xl mx-auto w-full hidden">
            <header class="mb-8 flex justify-between items-center">
                <div>
                    <h2 class="text-3xl font-bold text-gray-800">Controle de Ativos Móveis</h2>
                    <p class="text-gray-500">Gerenciamento</p>
                </div>
                <div class="text-right">
                    <p class="font-semibold text-gray-700">Utilizador: <span id="logged-in-user"></span></p>
                    <button id="logout-btn" class="text-sm text-blue-600 hover:underline">Sair</button>
                </div>
            </header>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-4 mb-8">
                <button id="add-record-btn" class="bg-blue-600 text-white p-4 rounded-lg shadow hover:bg-blue-700 flex flex-col items-center justify-center text-center"><i data-lucide="file-plus-2" class="w-8 h-8 mb-2"></i><span class="font-semibold">Novo Termo</span></button>
                <button id="manage-employees-btn" data-permission="employees" class="bg-purple-600 text-white p-4 rounded-lg shadow hover:bg-purple-700 flex flex-col items-center justify-center text-center"><i data-lucide="users" class="w-8 h-8 mb-2"></i><span class="font-semibold">Funcionários</span></button>
                <button id="manage-devices-btn" data-permission="devices" class="bg-green-600 text-white p-4 rounded-lg shadow hover:bg-green-700 flex flex-col items-center justify-center text-center"><i data-lucide="smartphone" class="w-8 h-8 mb-2"></i><span class="font-semibold">Aparelhos</span></button>
                <button id="manage-lines-btn" data-permission="lines" class="bg-teal-600 text-white p-4 rounded-lg shadow hover:bg-teal-700 flex flex-col items-center justify-center text-center"><i data-lucide="phone" class="w-8 h-8 mb-2"></i><span class="font-semibold">Linhas</span></button>
                <button id="manage-maintenance-btn" data-permission="maintenance" class="bg-orange-600 text-white p-4 rounded-lg shadow hover:bg-orange-700 flex flex-col items-center justify-center text-center"><i data-lucide="wrench" class="w-8 h-8 mb-2"></i><span class="font-semibold">Manutenção</span></button>
                <button id="manage-users-btn" data-permission="users" class="bg-gray-700 text-white p-4 rounded-lg shadow hover:bg-gray-800 flex flex-col items-center justify-center text-center"><i data-lucide="user-cog" class="w-8 h-8 mb-2"></i><span class="font-semibold">Utilizadores</span></button>
                <button id="company-info-btn" class="bg-indigo-600 text-white p-4 rounded-lg shadow hover:bg-indigo-700 flex flex-col items-center justify-center text-center"><i data-lucide="building" class="w-8 h-8 mb-2"></i><span class="font-semibold">Empresa</span></button>
                <button id="generate-report-btn" class="bg-pink-600 text-white p-4 rounded-lg shadow hover:bg-pink-700 flex flex-col items-center justify-center text-center"><i data-lucide="printer" class="w-8 h-8 mb-2"></i><span class="font-semibold">Relatórios</span></button>
            </div>
            <div id="dashboard-section" class="mb-8">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-lg flex items-center justify-between">
                        <div><p class="text-sm font-medium text-gray-500">Total de Aparelhos</p><p id="stats-total-devices" class="text-3xl font-bold text-gray-800">0</p></div>
                        <div class="bg-blue-100 p-3 rounded-full"><i data-lucide="smartphone" class="w-6 h-6 text-blue-600"></i></div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-lg flex items-center justify-between">
                        <div><p class="text-sm font-medium text-gray-500">Aparelhos em Uso</p><p id="stats-in-use-devices" class="text-3xl font-bold text-gray-800">0</p></div>
                        <div class="bg-green-100 p-3 rounded-full"><i data-lucide="user-check" class="w-6 h-6 text-green-600"></i></div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-lg flex items-center justify-between">
                        <div><p class="text-sm font-medium text-gray-500">Em Manutenção</p><p id="stats-maintenance-devices" class="text-3xl font-bold text-gray-800">0</p></div>
                        <div class="bg-orange-100 p-3 rounded-full"><i data-lucide="wrench" class="w-6 h-6 text-orange-600"></i></div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-lg flex items-center justify-between">
                        <div><p class="text-sm font-medium text-gray-500">Total de Funcionários</p><p id="stats-total-employees" class="text-3xl font-bold text-gray-800">0</p></div>
                        <div class="bg-purple-100 p-3 rounded-full"><i data-lucide="users" class="w-6 h-6 text-purple-600"></i></div>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-8">
                    <div class="bg-white p-6 rounded-lg shadow-lg">
                        <h3 class="font-bold text-gray-700 mb-4">Status dos Aparelhos</h3>
                        <canvas id="deviceStatusChart"></canvas>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-lg">
                        <h3 class="font-bold text-gray-700 mb-4">Condição do Inventário</h3>
                        <canvas id="deviceConditionChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-4"><h3 class="text-xl font-bold text-gray-800">Movimentações Atuais</h3><div id="filter-container" class="flex items-center gap-2 bg-gray-200 rounded-full p-1"><button data-filter="Todos" class="filter-btn px-4 py-1 text-sm rounded-full bg-blue-600 text-white">Todos</button><button data-filter="Em Uso" class="filter-btn px-4 py-1 text-sm rounded-full bg-gray-200 text-gray-700">Em Uso</button><button data-filter="Devolvido" class="filter-btn px-4 py-1 text-sm rounded-full bg-gray-200 text-gray-700">Devolvido</button></div></div>
                <div class="overflow-x-auto"><table class="w-full text-sm text-left text-gray-600"><thead id="main-table-header" class="text-xs text-gray-700 uppercase bg-gray-50"><tr><th class="p-4 cursor-pointer" data-sort="employeeName">Funcionário <span class="sort-indicator"></span></th><th class="p-4 cursor-pointer" data-sort="deviceModel">Aparelho <span class="sort-indicator"></span></th><th class="p-4 cursor-pointer" data-sort="deliveryDate">Data de Entrega <span class="sort-indicator"></span></th><th class="p-4 cursor-pointer" data-sort="status">Status <span class="sort-indicator"></span></th><th class="p-4 text-center no-print">Ações</th></tr></thead><tbody id="records-table-body"></tbody></table><p id="no-records-message" class="text-center text-gray-500 py-8 hidden">Nenhuma movimentação encontrada.</p>
                </div>
                <div id="pagination-controls" class="flex justify-between items-center mt-4">
                    <p id="pagination-info" class="text-sm text-gray-600"></p>
                    <div id="pagination-buttons" class="flex gap-2"></div>
                </div>
            </div>
        </div>
    </main>
    
    <footer class="bg-white border-t border-gray-200 text-center py-3 text-sm text-gray-500 no-print">
        © 2025 SMARTCONTROL — Todos os direitos reservados.
    </footer>

    <div id="print-section" style="display:none;"></div>
    <div id="toast" class="toast fixed bottom-5 right-5 text-white py-3 px-6 rounded-lg shadow-lg opacity-0 z-50"><p id="toast-message"></p></div>

    <div id="record-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col">
            <header class="p-4 border-b flex justify-between items-center">
                <h2 id="modal-title" class="text-xl font-bold">Novo Termo de Responsabilidade</h2>
                <button onclick="handleCloseModal('record-modal')" id="cancel-btn">&times;</button>
            </header>
            <form id="record-form" class="p-6 overflow-y-auto space-y-6">
                <input type="hidden" id="record-id">
                <fieldset id="delivery-fieldset" class="border p-4 rounded-md">
                    <legend class="px-2 font-semibold">Dados de Entrega</legend>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label for="employeeSelect" class="block text-sm font-medium">Funcionário</label><select id="employeeSelect" class="mt-1 w-full border-gray-300 rounded-md" required></select></div>
                        <div><label for="deviceSelect" class="block text-sm font-medium">Aparelho (IMEI)</label><select id="deviceSelect" class="mt-1 w-full border-gray-300 rounded-md" required></select></div>
                        <div><label for="deviceLineDisplay" class="block text-sm font-medium">Linha Vinculada</label><input type="text" id="deviceLineDisplay" class="mt-1 w-full bg-gray-100 border-gray-300 rounded-md" readonly></div>
                        <div><label for="deliveryDate" class="block text-sm font-medium">Data de Entrega</label><input type="date" id="deliveryDate" class="mt-1 w-full border-gray-300 rounded-md" required></div>
                        <div><label for="deliveryCondition" class="block text-sm font-medium">Condição na Entrega</label><select id="deliveryCondition" class="mt-1 w-full border-gray-300 rounded-md"><option>Novo</option><option>Aprovado para uso</option></select></div>
                        <div class="md:col-span-2"><label class="block text-sm font-medium">Acessórios</label><div class="mt-2 flex flex-wrap gap-4"><label class="flex items-center"><input type="checkbox" name="accessories" value="Carregador" class="mr-2">Carregador</label><label class="flex items-center"><input type="checkbox" name="accessories" value="Cabo USB" class="mr-2">Cabo USB</label><label class="flex items-center"><input type="checkbox" name="accessories" value="Caixa" class="mr-2">Caixa</label><label class="flex items-center"><input type="checkbox" name="accessories" value="Fone de Ouvido" class="mr-2">Fone de Ouvido</label></div></div>
                        <div class="md:col-span-2"><label for="deliveryNotes" class="block text-sm font-medium">Observações da Entrega</label><textarea id="deliveryNotes" rows="2" class="mt-1 w-full border-gray-300 rounded-md"></textarea></div>
                         <div><label class="block text-sm font-medium">Anexar Termo de Entrega</label><input type="file" id="deliveryTermAttachment" class="mt-1 w-full text-sm"><input type="hidden" id="deliveryTermUrl"><a href="#" id="viewDeliveryTermBtn" target="_blank" class="hidden text-blue-600 hover:underline">Ver Anexo</a></div>
                    </div>
                </fieldset>
                <fieldset id="return-fieldset" class="border p-4 rounded-md hidden">
                    <legend class="px-2 font-semibold">Dados de Devolução</legend>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div><label for="returnDate" class="block text-sm font-medium">Data de Devolução</label><input type="date" id="returnDate" class="mt-1 w-full border-gray-300 rounded-md"></div>
                        <div><label for="returnCondition" class="block text-sm font-medium">Condição na Devolução</label><select id="returnCondition" class="mt-1 w-full border-gray-300 rounded-md"><option value="">Selecione...</option><option value="Bom">Bom estado</option><option value="Danificado">Danificado</option><option value="Perda/Roubo">Perda/Roubo</option></select></div>
                        <div class="md:col-span-2"><label for="returnNotes" class="block text-sm font-medium">Observações da Devolução</label><textarea id="returnNotes" rows="2" class="mt-1 w-full border-gray-300 rounded-md"></textarea></div>
                        <div><label for="returnChecker" class="block text-sm font-medium">Recebido por</label><input type="text" id="returnChecker" class="mt-1 w-full border-gray-300 rounded-md"></div>
                        <div id="return-term-attachment-section" style="display: none;"><label class="block text-sm font-medium">Anexar Termo de Devolução</label><input type="file" id="returnTermAttachment" class="mt-1 w-full text-sm"><input type="hidden" id="returnTermUrl"><a href="#" id="viewReturnTermBtn" target="_blank" class="hidden text-blue-600 hover:underline">Ver Anexo</a></div>
                        <div id="police-report-attachment-section" style="display: none;"><label class="block text-sm font-medium">Anexar B.O.</label><input type="file" id="policeReportAttachment" class="mt-1 w-full text-sm"><input type="hidden" id="policeReportUrl"><a href="#" id="viewPoliceReportBtn" target="_blank" class="hidden text-blue-600 hover:underline">Ver Anexo</a></div>
                    </div>
                </fieldset>
                <footer class="p-4 bg-gray-50 flex justify-end gap-3">
                    <button type="button" id="print-term-btn" class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700">Imprimir</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Salvar</button>
                </footer>
            </form>
        </div>
    </div>
    
    <div id="company-info-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-md">
            <header class="p-4 border-b flex justify-between items-center"><h2 class="text-xl font-bold">Dados da Empresa</h2><button onclick="handleCloseModal('company-info-modal')" id="cancel-company-info-btn">&times;</button></header>
            <form id="company-info-form" class="p-6 space-y-4">
                <div><label for="companyName" class="block text-sm font-medium">Nome da Empresa</label><input type="text" id="companyName" class="mt-1 w-full border-gray-300 rounded-md"></div>
                <div><label for="companyCnpj" class="block text-sm font-medium">CNPJ</label><input type="text" id="companyCnpj" class="mt-1 w-full border-gray-300 rounded-md"></div>
                <div><label for="companyLogoInput" class="block text-sm font-medium">Logótipo</label><input type="file" id="companyLogoInput" accept="image/*" class="mt-1 w-full text-sm"><img id="logo-preview" src="#" alt="Pré-visualização do Logótipo" class="mt-2 h-16 hidden"></div>
                <footer class="p-4 bg-gray-50 flex justify-end gap-3"><button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Salvar Alterações</button></footer>
            </form>
        </div>
    </div>

    <div id="user-list-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <header class="p-4 border-b flex justify-between items-center flex-shrink-0">
                <h2 class="text-xl font-bold">Gerir Utilizadores</h2>
                <button onclick="handleCloseModal('user-list-modal')" id="close-user-list-btn">&times;</button>
            </header>
            <div class="overflow-y-auto">
                <div class="p-6">
                    <button id="add-user-btn" class="mb-4 px-4 py-2 bg-blue-600 text-white rounded-md">Novo Utilizador</button>
                    <div class="mb-4"><input type="text" id="user-search-input" placeholder="Pesquisar por nome ou utilizador..." class="w-full border-gray-300 rounded-md shadow-sm"></div>
                    <table class="w-full text-sm"><thead><tr class="border-b"><th class="p-2 text-left">Nome</th><th class="p-2 text-left">Utilizador</th><th class="p-2 text-left">Perfil</th><th class="p-2 text-center">Ações</th></tr></thead><tbody id="user-table-body"></tbody></table>
                </div>
            </div>
        </div>
    </div>

    <div id="user-form-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-lg">
             <header class="p-4 border-b flex justify-between items-center"><h2 id="user-modal-title" class="text-xl font-bold">Novo Utilizador</h2><button onclick="handleCloseModal('user-form-modal')" id="cancel-user-form-btn">&times;</button></header>
            <form id="user-form" class="p-6 space-y-4">
                <input type="hidden" id="user-id-input">
                <div><label for="userFormFullName">Nome Completo</label><input type="text" id="userFormFullName" class="mt-1 w-full rounded-md" required></div>
                <div><label for="userFormUsername">Nome de Utilizador</label><input type="text" id="userFormUsername" class="mt-1 w-full rounded-md" required></div>
                <div><label for="userFormPassword">Senha</label><input type="password" id="userFormPassword" class="mt-1 w-full rounded-md" placeholder="Deixe em branco para não alterar"></div>
                <div><label for="userFormRole">Perfil</label><select id="userFormRole" class="mt-1 w-full rounded-md"><option value="controlador">Controlador</option><option value="administrador">Administrador</option></select></div>
                <fieldset id="permissions-fieldset" class="border p-4 rounded-md"><legend class="px-2 font-semibold">Permissões</legend><div class="grid grid-cols-2 gap-2"><label><input type="checkbox" data-permission="employees"> Gerir Funcionários</label><label><input type="checkbox" data-permission="devices"> Gerir Aparelhos</label><label><input type="checkbox" data-permission="lines"> Gerir Linhas</label><label><input type="checkbox" data-permission="maintenance"> Gerir Manutenção</label></div></fieldset>
                <footer class="p-4 bg-gray-50 flex justify-end"><button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md">Salvar</button></footer>
            </form>
        </div>
    </div>

    <div id="employee-list-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col">
            <header class="p-4 border-b flex justify-between items-center flex-shrink-0">
                <h2 class="text-xl font-bold">Gerir Funcionários</h2>
                <button onclick="handleCloseModal('employee-list-modal')" id="close-employee-list-btn">&times;</button>
            </header>
            <div class="overflow-y-auto">
                <div class="p-6">
                    <div class="flex gap-2 mb-4">
                        <button id="add-employee-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md">Novo Funcionário</button>
                        <button id="employee-export-btn" class="px-4 py-2 bg-green-600 text-white rounded-md">Exportar CSV</button>
                        <input type="file" id="employee-import-input" class="hidden">
                        <button onclick="document.getElementById('employee-import-input').click()" class="px-4 py-2 bg-gray-600 text-white rounded-md">Importar CSV</button>
                    </div>
                    <div class="mb-4"><input type="text" id="employee-search-input" placeholder="Pesquisar por nome ou matrícula..." class="w-full border-gray-300 rounded-md shadow-sm"></div>
                    <table class="w-full text-sm"><thead><tr class="border-b"><th class="p-2 text-left">Nome</th><th class="p-2 text-left">Matrícula</th><th class="p-2 text-left">Cargo</th><th class="p-2 text-center">Ações</th></tr></thead><tbody id="employee-table-body"></tbody></table>
                    <p id="no-employees-message" class="hidden text-center py-4">Nenhum funcionário encontrado.</p>
                </div>
            </div>
        </div>
    </div>
    
    <div id="employee-form-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-lg"><header class="p-4 border-b flex justify-between items-center"><h2 id="employee-modal-title" class="text-xl font-bold">Novo Funcionário</h2><button onclick="handleCloseModal('employee-form-modal')" id="cancel-employee-form-btn">&times;</button></header><form id="employee-form" class="p-6 space-y-4"><input type="hidden" id="employee-id-input"><div><label>Nome</label><input type="text" id="employeeFormName" class="mt-1 w-full rounded-md" required></div><div><label>Matrícula</label><input type="text" id="employeeFormId" class="mt-1 w-full rounded-md" required></div><div><label>Cargo</label><input type="text" id="employeeFormPosition" class="mt-1 w-full rounded-md" required></div><div><label>Email</label><input type="email" id="employeeFormEmail" class="mt-1 w-full rounded-md"></div><footer class="pt-4 flex justify-end"><button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md">Salvar</button></footer></form></div>
    </div>
    
    <div id="employee-history-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-2xl"><header class="p-4 border-b flex justify-between items-center"><h2 id="history-employee-name" class="text-xl font-bold">Histórico</h2><button onclick="handleCloseModal('employee-history-modal')" id="close-history-modal-btn">&times;</button></header><div class="p-6"><table class="w-full text-sm"><thead><tr class="border-b"><th class="p-2 text-left">Aparelho</th><th class="p-2 text-left">Data Entrega</th><th class="p-2 text-left">Data Devolução</th><th class="p-2 text-left">Status</th></tr></thead><tbody id="employee-history-table-body"></tbody></table><p id="no-history-message" class="hidden text-center py-4">Nenhum histórico encontrado.</p></div></div>
    </div>

    <div id="device-list-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col">
            <header class="p-4 border-b flex justify-between items-center flex-shrink-0">
                <h2 class="text-xl font-bold">Gerir Aparelhos</h2>
                <button onclick="handleCloseModal('device-list-modal')" id="close-device-list-btn">&times;</button>
            </header>
            <div class="overflow-y-auto">
                <div class="p-6">
                    <div class="flex gap-2 mb-4">
                        <button id="add-device-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md">Novo Aparelho</button>
                        <button id="device-export-btn" class="px-4 py-2 bg-green-600 text-white rounded-md">Exportar CSV</button>
                        <input type="file" id="device-import-input" class="hidden">
                        <button onclick="document.getElementById('device-import-input').click()" class="px-4 py-2 bg-gray-600 text-white rounded-md">Importar CSV</button>
                    </div>
                    <div class="mb-4"><input type="text" id="device-search-input" placeholder="Pesquisar por modelo ou IMEI..." class="w-full border-gray-300 rounded-md shadow-sm"></div>
                    <table class="w-full text-sm"><thead><tr class="border-b"><th class="p-2 text-left">Modelo</th><th class="p-2 text-left">IMEI</th><th class="p-2 text-left">Linha</th><th class="p-2 text-left">Status</th><th class="p-2 text-left">Condição</th><th class="p-2 text-center">Ações</th></tr></thead><tbody id="device-table-body"></tbody></table>
                    <p id="no-devices-message" class="hidden text-center py-4">Nenhum aparelho encontrado.</p>
                </div>
            </div>
        </div>
    </div>
    
    <div id="device-form-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-lg"><header class="p-4 border-b flex justify-between items-center"><h2 id="device-modal-title">Novo Aparelho</h2><button onclick="handleCloseModal('device-form-modal')" id="cancel-device-form-btn">&times;</button></header><form id="device-form" class="p-6 space-y-4"><input type="hidden" id="device-id-input"><div><label>Modelo</label><input type="text" id="deviceFormModel" class="mt-1 w-full rounded-md" required></div><div><label>IMEI 1</label><input type="text" id="deviceFormImei1" class="mt-1 w-full rounded-md" required></div><div><label>IMEI 2</label><input type="text" id="deviceFormImei2" class="mt-1 w-full rounded-md"></div><div><label>Cor/Observações</label><input type="text" id="deviceFormColorNotes" class="mt-1 w-full rounded-md"></div><div><label>Condição</label><select id="deviceFormCondition" class="mt-1 w-full rounded-md"><option>Novo</option><option>Aprovado para uso</option><option>Com Defeito</option><option>Danificado</option></select></div><div><label>Vincular Linha</label><select id="deviceFormLine" class="mt-1 w-full rounded-md"></select></div><footer class="pt-4 flex justify-end"><button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md">Salvar</button></footer></form></div>
    </div>
    
    <div id="device-history-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col">
            <header class="p-4 border-b flex justify-between items-center flex-shrink-0">
                <h2 id="history-device-name">Histórico</h2>
                <button onclick="handleCloseModal('device-history-modal')" id="close-device-history-modal-btn">&times;</button>
            </header>
            <div class="p-6 space-y-4 overflow-y-auto">
                <h3>Histórico de Utilização</h3>
                <table class="w-full text-sm"><thead><tr class="border-b"><th class="p-2 text-left">Funcionário</th><th class="p-2 text-left">Data Entrega</th><th class="p-2 text-left">Data Devolução</th></tr></thead><tbody id="device-history-table-body"></tbody></table>
                <p id="no-device-history-message" class="hidden text-center py-4">Nenhum histórico encontrado.</p>
                
                <h3>Histórico de Manutenção</h3>
                <table class="w-full text-sm"><thead><tr class="border-b"><th class="p-2 text-left">Data Envio</th><th class="p-2 text-left">Data Retorno</th><th class="p-2 text-left">Defeito</th><th class="p-2 text-left">Custo</th><th class="p-2 text-left">Status</th></tr></thead><tbody id="device-maintenance-history-table-body"></tbody></table>
                <p id="no-device-maintenance-history-message" class="hidden text-center py-4">Nenhum histórico encontrado.</p>

                <h3 class="mt-4">Histórico de Alterações (Auditoria)</h3>
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b">
                            <th class="p-2 text-left">Data</th>
                            <th class="p-2 text-left">Utilizador</th>
                            <th class="p-2 text-left">Ação</th>
                            <th class="p-2 text-left">Detalhes</th>
                        </tr>
                    </thead>
                    <tbody id="device-audit-history-table-body"></tbody>
                </table>
                <p id="no-device-audit-history-message" class="hidden text-center py-4">Nenhum histórico de alterações encontrado para este aparelho.</p>
            </div>
        </div>
    </div>
    
    <div id="line-list-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] flex flex-col">
            <header class="p-4 border-b flex justify-between items-center flex-shrink-0">
                <h2 class="text-xl font-bold">Gerir Linhas</h2>
                <button onclick="handleCloseModal('line-list-modal')" id="close-line-list-btn">&times;</button>
            </header>
            <div class="overflow-y-auto">
                <div class="p-6">
                    <div class="flex gap-2 mb-4">
                        <button id="add-line-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md">Nova Linha</button>
                        <button id="line-export-btn" class="px-4 py-2 bg-green-600 text-white rounded-md">Exportar CSV</button>
                        <input type="file" id="line-import-input" class="hidden" accept=".csv">
                        <button onclick="document.getElementById('line-import-input').click()" class="px-4 py-2 bg-gray-600 text-white rounded-md">Importar CSV</button>
                    </div>
                    <div class="mb-4">
                        <input type="text" id="line-search-input" placeholder="Pesquisar por número ou operadora..." class="w-full border-gray-300 rounded-md shadow-sm">
                    </div>
                    
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b">
                                <th class="p-2 text-left">Número</th>
                                <th class="p-2 text-left">Operadora</th>
                                <th class="p-2 text-left">Status</th>
                                <th class="p-2 text-left">IMEI Vinculado</th>
                                <th class="p-2 text-center">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="line-table-body"></tbody>
                    </table>
                    <p id="no-lines-message" class="hidden text-center py-4">Nenhuma linha encontrada.</p>
                    </div>
            </div>
        </div>
    </div>

    <div id="line-form-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-lg"><header class="p-4 border-b flex justify-between items-center"><h2 id="line-modal-title">Nova Linha</h2><button onclick="handleCloseModal('line-form-modal')" id="cancel-line-form-btn">&times;</button></header><form id="line-form" class="p-6 space-y-4"><input type="hidden" id="line-id-input"><div><label>Número</label><input type="text" id="lineFormNumber" class="mt-1 w-full rounded-md" required></div><div><label>Operadora</label><input type="text" id="lineFormCarrier" class="mt-1 w-full rounded-md" required></div><div><label>Plano</label><input type="text" id="lineFormPlan" class="mt-1 w-full rounded-md"></div><div><label>Status</label><select id="lineFormStatus" class="mt-1 w-full rounded-md"><option>Ativa</option><option>Inativa</option><option>Cancelada</option></select></div><footer class="pt-4 flex justify-end"><button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md">Salvar</button></footer></form></div>
    </div>
    
    <div id="line-history-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-2xl"><header class="p-4 border-b flex justify-between items-center"><h2 id="history-line-number">Histórico</h2><button onclick="handleCloseModal('line-history-modal')" id="close-line-history-modal-btn">&times;</button></header><div class="p-6"><table class="w-full text-sm"><thead><tr class="border-b"><th class="p-2 text-left">IMEI</th><th class="p-2 text-left">Data Vinculação</th><th class="p-2 text-left">Data Desvinculação</th></tr></thead><tbody id="line-history-table-body"></tbody></table><p id="no-line-history-message" class="hidden text-center py-4">Nenhum histórico encontrado.</p></div></div>
    </div>

    <div id="maintenance-list-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col">
            <header class="p-4 border-b flex justify-between items-center flex-shrink-0">
                <h2 class="text-xl font-bold">Gerir Manutenção</h2>
                <button onclick="handleCloseModal('maintenance-list-modal')" id="close-maintenance-list-btn">&times;</button>
            </header>
            <div class="overflow-y-auto">
                <div class="p-6">
                        <button id="add-maintenance-btn" class="mb-4 px-4 py-2 bg-blue-600 text-white rounded-md">Novo Envio</button>
                        
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="border-b">
                                    <th class="p-2 text-left">Nº OS</th>
                                    <th class="p-2 text-left">Aparelho</th>
                                    <th class="p-2 text-left">Data Envio</th>
                                    <th class="p-2 text-left">Status</th>
                                    <th class="p-2 text-center">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="maintenance-table-body"></tbody>
                        </table>
                        <p id="no-maintenance-message" class="hidden text-center py-4">Nenhum registo de manutenção.</p>
                    </div>
            </div>
        </div>
    </div>
    
    <div id="maintenance-form-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-lg"><header class="p-4 border-b flex justify-between items-center"><h2 id="maintenance-modal-title">Enviar para Manutenção</h2><button onclick="handleCloseModal('maintenance-form-modal')" id="cancel-maintenance-form-btn">&times;</button></header><form id="maintenance-form" class="p-6 space-y-4"><input type="hidden" id="maintenance-id-input"><div><label>Aparelho</label><select id="maintenanceDeviceSelect" class="mt-1 w-full rounded-md" required></select></div><div><label>Data de Envio</label><input type="date" id="maintenanceSendDate" class="mt-1 w-full rounded-md" required></div><div><label>Defeito Reportado</label><textarea id="maintenanceDefect" rows="3" class="mt-1 w-full rounded-md" required></textarea></div><div><label>Fornecedor</label><input type="text" id="maintenanceSupplier" class="mt-1 w-full rounded-md"></div><div id="maintenance-return-section" style="display:none;" class="space-y-4 border-t pt-4 mt-4"><hr><div><label>Data de Retorno</label><input type="date" id="maintenanceReturnDate" class="mt-1 w-full rounded-md"></div><div><label>Serviço Realizado</label><textarea id="maintenanceService" rows="3" class="mt-1 w-full rounded-md"></textarea></div><div><label>Custo (R$)</label><input type="number" step="0.01" id="maintenanceCost" class="mt-1 w-full rounded-md"></div><div><label>Condição Pós-Manutenção</label><select id="maintenancePostCondition" class="mt-1 w-full rounded-md"><option value="Aprovado para uso">Aprovado para uso</option><option value="Danificado">Danificado (Sem conserto)</option><option value="Sinistrado">Sinistrado</option></select></div><div><label>Status</label><select id="maintenanceStatus" class="mt-1 w-full rounded-md"><option value="Em manutenção">Em manutenção</option><option value="Concluído">Concluído</option><option value="Cancelado">Cancelado</option></select></div></div><footer class="pt-4 flex justify-end gap-2"><button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md">Salvar</button></footer></form></div>
    </div>

    <div id="report-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-md"><header class="p-4 border-b flex justify-between items-center"><h2 class="text-xl font-bold">Gerar Relatórios</h2><button onclick="handleCloseModal('report-modal')" id="close-report-modal-btn">&times;</button></header><div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4"><button id="report-general-btn" class="p-4 bg-blue-100 rounded-md text-center">Relatório Geral</button><button id="report-devices-btn" class="p-4 bg-green-100 rounded-md text-center">Inventário de Aparelhos</button><button id="report-lines-btn" class="p-4 bg-teal-100 rounded-md text-center">Inventário de Linhas</button><button id="report-maintenance-btn" class="p-4 bg-orange-100 rounded-md text-center">Relatório de Manutenção</button></div></div>
    </div>
    <div id="line-term-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-lg">
            <header class="p-4 border-b flex justify-between items-center">
                <h2 id="line-term-modal-title" class="text-xl font-bold">Termo de Uso de Linha</h2>
                <button onclick="handleCloseModal('line-term-modal')">&times;</button>
            </header>
            <form id="line-term-form" class="p-6 space-y-4">
                <input type="hidden" id="line-term-id">
                <input type="hidden" id="line-term-line-id">
                <div>
                    <label>Linha</label>
                    <input type="text" id="line-term-number-display" class="mt-1 w-full rounded-md bg-gray-100" readonly>
                </div>
                <div>
                    <label for="line-term-employee-select">Associar ao Funcionário</label>
                    <select id="line-term-employee-select" class="mt-1 w-full rounded-md" required></select>
                </div>
                <div>
                    <label>Data de Entrega</label>
                    <input type="date" id="line-term-delivery-date" class="mt-1 w-full rounded-md" required>
                </div>
                <footer class="pt-4 flex justify-end gap-3">
                    <button type="button" id="line-term-print-btn" class="px-4 py-2 bg-gray-600 text-white rounded-md">Imprimir</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md">Salvar</button>
                </footer>
            </form>
        </div>
    </div>
    
         </div>
    </div>
    
    <!-- =================================================================== -->
    <!-- =================== TEMPLATES PARA IMPRESSÃO ====================== -->
    <!-- =================================================================== -->

    <!-- Template para Termo de Responsabilidade de Aparelho -->
    <template id="record-term-print-template">
        <div class="print-container">
            <!-- O cabeçalho será injetado pelo JavaScript -->
            {{header}}

            <h1 class="term-title">
                TERMO DE RESPONSABILIDADE Nº {{id}}
            </h1>

            <!-- Seção 1: Dados do Funcionário -->
            <h3 class="section-title">1. DADOS DO FUNCIONÁRIO</h3>
            <table class="data-table">
                <tbody>
                    <tr>
                        <td class="data-label">Nome Completo:</td>
                        <td>{{employeeName}}</td>
                    </tr>
                    <tr>
                        <td class="data-label">Matrícula:</td>
                        <td>{{employeeMatricula}}</td>
                    </tr>
                    <tr>
                        <td class="data-label">Cargo:</td>
                        <td>{{employeePosition}}</td>
                    </tr>
                </tbody>
            </table>

            <!-- Seção 2: Dados do Equipamento -->
            <h3 class="section-title">2. DADOS DO EQUIPAMENTO</h3>
            <table class="data-table">
                <tbody>
                    <tr>
                        <td class="data-label">Modelo:</td>
                        <td>{{deviceModel}}</td>
                    </tr>
                    <tr>
                        <td class="data-label">IMEI Principal:</td>
                        <td>{{deviceImei}}</td>
                    </tr>
                    <tr>
                        <td class="data-label">Linha Telefónica:</td>
                        <td>{{deviceLine}}</td>
                    </tr>
                    <tr>
                        <td class="data-label">Acessórios Inclusos:</td>
                        <td>{{accessories}}</td>
                    </tr>
                </tbody>
            </table>

            <!-- Seção 3: Termo de Entrega -->
            <h3 class="section-title">3. TERMO DE ENTREGA</h3>
            <table class="data-table">
                <tbody>
                    <tr>
                        <td class="data-label">Data de Entrega:</td>
                        <td>{{deliveryDate}}</td>
                    </tr>
                    <tr>
                        <td class="data-label">Condição:</td>
                        <td>{{deliveryCondition}}</td>
                    </tr>
                    <tr>
                        <td class="data-label">Observações:</td>
                        <td>{{deliveryNotes}}</td>
                    </tr>
                    <tr>
                        <td class="data-label">Entregue por:</td>
                        <td>{{delivererName}}</td>
                    </tr>
                </tbody>
            </table>

            <div class="declaration-box">
                <p><strong>Declaração do Funcionário:</strong><br>
                    Declaro que recebi o equipamento e acessórios acima descritos em perfeitas condições, responsabilizando-me por sua guarda, conservação e uso adequado durante o período em que estiver sob minha posse. Comprometo-me a devolver o equipamento nas mesmas condições de uso, ressalvado o desgaste natural. Em caso de perda, roubo ou dano intencional, assumo a responsabilidade pelos prejuízos causados.
                </p>
            </div>

            <div class="signatures">
                <div class="signature-block">
                    <div class="signature-line"></div>
                    <p class="signature-name">{{employeeName}}</p>
                    <p class="signature-role">Assinatura do Funcionário</p>
                </div>
                <div class="signature-block">
                    <div class="signature-line"></div>
                    <p class="signature-name">{{delivererName}}</p>
                    <p class="signature-role">Assinatura do Responsável</p>
                </div>
            </div>

            <!-- A seção de devolução será injetada aqui pelo JavaScript -->
            {{returnSection}}

            <div class="footer-print">
                <p>Documento gerado eletronicamente em {{generationTimestamp}}</p>
            </div>
        </div>
    </template>

    <!-- Template para a Seção de Devolução (usado pelo JS) -->
    <template id="record-return-section-template">
        <div class="return-section">
            <h3 class="section-title">4. TERMO DE DEVOLUÇÃO</h3>
            <table class="data-table">
                <tbody>
                    <tr>
                        <td class="data-label">Data de Devolução:</td>
                        <td>{{returnDate}}</td>
                    </tr>
                    <tr>
                        <td class="data-label">Condição:</td>
                        <td>{{returnCondition}}</td>
                    </tr>
                    <tr>
                        <td class="data-label">Observações:</td>
                        <td>{{returnNotes}}</td>
                    </tr>
                    <tr>
                        <td class="data-label">Recebido por:</td>
                        <td>{{receiverName}}</td>
                    </tr>
                </tbody>
            </table>
            <div class="declaration-box">
                <p><strong>Declaração do Funcionário:</strong><br>
                    Declaro que devolvi o equipamento e todos os acessórios acima descritos, nas condições informadas, e que não possuo mais a posse ou responsabilidade sobre os mesmos.
                </p>
            </div>
            <div class="signatures">
                <div class="signature-block">
                    <div class="signature-line"></div>
                    <p class="signature-name">{{employeeName}}</p>
                    <p class="signature-role">Assinatura do Funcionário</p>
                </div>
                <div class="signature-block">
                    <div class="signature-line"></div>
                    <p class="signature-name">{{receiverName}}</p>
                    <p class="signature-role">Assinatura do Receptor</p>
                </div>
            </div>
        </div>
    </template>

    <!-- Template para Termo de Linha -->
    <template id="line-term-print-template">
        <div class="print-container" style="font-size:12px; max-width:800px; margin:0 auto;">
            {{header}}
            
            <h1 class="term-title" style="margin: 32px 0; border-bottom:3px solid #333; padding-bottom:12px;">
                Termo de Responsabilidade de Linha Nº {{id}}
            </h1>
            
            <div style="background:#e6f7ff; border-left:4px solid #1890ff; padding:16px; margin:24px 0; border-radius:4px;">
                <p style="margin:0; font-size:11px; line-height:1.6;">
                    <strong>ℹ️ Informação:</strong> Este documento estabelece a responsabilidade do funcionário 
                    sobre o uso da linha telefónica corporativa fornecida pela empresa.
                </p>
            </div>
            
            <h3 class="section-title" style="border-bottom-width: 2px;">1. DADOS DO FUNCIONÁRIO</h3>
            <table class="data-table">
                <tr>
                    <td class="data-label" style="width:35%;">Nome Completo:</td>
                    <td>{{employeeName}}</td>
                </tr>
                <tr>
                    <td class="data-label">Matrícula:</td>
                    <td>{{employeeMatricula}}</td>
                </tr>
            </table>
            
            <h3 class="section-title" style="border-bottom-width: 2px;">2. DADOS DA LINHA TELEFÓNICA</h3>
            <table class="data-table">
                <tr>
                    <td class="data-label" style="width:35%;">Número:</td>
                    <td style="font-size:16px; font-weight:600; color:#059669;">{{numero}}</td>
                </tr>
                <tr>
                    <td class="data-label">Data de Entrega:</td>
                    <td>{{deliveryDate}}</td>
                </tr>
                <tr>
                    <td class="data-label">Entregue por:</td>
                    <td>{{delivererName}}</td>
                </tr>
            </table>
            
            <h3 class="section-title" style="margin-top: 32px; border-bottom-width: 2px;">3. TERMOS E RESPONSABILIDADES</h3>
            <div style="background:#f9fafb; border:1px solid #ddd; padding:20px; border-radius:8px; margin-bottom:24px; font-size:11px; line-height:1.8;">
                <p style="margin:0 0 12px 0;"><strong>O funcionário declara estar ciente e concorda com os seguintes termos:</strong></p>
                <ol style="margin:0; padding-left:20px;"><li style="margin-bottom:8px;">A linha telefónica é de propriedade da empresa e destina-se exclusivamente ao uso profissional;</li><li style="margin-bottom:8px;">É de responsabilidade do funcionário zelar pelo SIM card e informar imediatamente em caso de perda, roubo ou dano;</li><li style="margin-bottom:8px;">O uso indevido ou excessivo da linha pode resultar em medidas disciplinares;</li><li style="margin-bottom:8px;">Em caso de desligamento ou devolução, o SIM card deverá ser devolvido intacto;</li><li style="margin-bottom:8px;">Custos com uso indevido ou perda do chip poderão ser descontados em folha de pagamento;</li><li style="margin-bottom:8px;">A empresa reserva-se o direito de monitorar o uso da linha para fins de auditoria e segurança.</li></ol>
            </div>
            
            <div class="declaration-box" style="background:#fef3c7; border-color:#f59e0b; border-width:2px;"><p style="text-align:justify;"><strong>DECLARAÇÃO:</strong><br><br>Declaro que recebi o SIM card da linha telefónica acima identificada, em perfeitas condições, e que estou ciente de todas as responsabilidades e termos de uso estabelecidos neste documento. Comprometo-me a utilizar a linha exclusivamente para fins profissionais e a devolvê-la quando solicitado pela empresa ou ao término do vínculo empregatício.</p></div>
            
            <div class="signatures" style="margin-top:80px;">
                <div class="signature-block" style="width:40%;"><div class="signature-line" style="border-bottom-width:2px; height:60px; margin-bottom:8px;"></div><p class="signature-name">{{employeeName}}</p><p class="signature-role" style="font-size:10px;">Assinatura do Funcionário</p><p style="font-size:9px; color:#999; margin:4px 0;">CPF: ________________</p></div>
                <div class="signature-block" style="width:40%;"><div class="signature-line" style="border-bottom-width:2px; height:60px; margin-bottom:8px;"></div><p class="signature-name">{{delivererName}}</p><p class="signature-role" style="font-size:10px;">Assinatura do Responsável</p><p style="font-size:9px; color:#999; margin:4px 0;">Data: {{deliveryDate}}</p></div>
            </div>
            
            <div class="footer-print" style="margin-top:60px; font-size:10px;">
                <p style="margin:0;">Documento gerado eletronicamente em {{generationTimestamp}}</p>
                <p style="margin:4px 0;">Via única - Arquivo da empresa | Sistema SMARTCONTROL</p>
            </div>
        </div>
    </template>

    <!-- Template para Ordem de Reparo (Manutenção) -->
    <template id="maintenance-os-print-template">
        <div class="print-container" style="font-size:12px; max-width:800px; margin:0 auto;">
            {{header}}
            
            <h1 class="term-title" style="margin: 32px 0; border:3px solid #333; padding:16px; background:#f8f8f8;">
                Ordem de Reparo Nº {{numero_os}}
            </h1>
            
            <div style="text-align:center; margin:20px 0;">
                <span style="display:inline-block; padding:8px 20px; background:{{status_bg_color}}; color:white; border-radius:20px; font-weight:600; font-size:14px;">
                    {{status}}
                </span>
            </div>
            
            <h3 class="section-title" style="border-bottom-width: 2px;">1. DADOS DO EQUIPAMENTO</h3>
            <table class="data-table">
                <tr>
                    <td class="data-label" style="width:35%;">Modelo:</td>
                    <td>{{modelo}}</td>
                </tr>
                <tr>
                    <td class="data-label">IMEI:</td>
                    <td style="font-family:monospace; font-size:14px;">{{imei1}}</td>
                </tr>
                <tr>
                    <td class="data-label">Fornecedor/Assistência:</td>
                    <td>{{fornecedor}}</td>
                </tr>
            </table>
            
            <h3 class="section-title" style="border-bottom-width: 2px;">2. DETALHES DO REPARO</h3>
            <table class="data-table">
                <tr>
                    <td class="data-label" style="width:35%;">Data de Envio:</td>
                    <td>{{data_envio}}</td>
                </tr>
                <tr>
                    <td class="data-label">Data de Retorno:</td>
                    <td>{{data_retorno}}</td>
                </tr>
                <tr>
                    <td class="data-label" style="vertical-align:top;">Defeito Reportado:</td>
                    <td><div style="background:#fff9e6; padding:8px; border-left:3px solid #f59e0b;">{{defeito_reportado}}</div></td>
                </tr>
                {{servico_realizado_section}}
            </table>
            
            <h3 class="section-title" style="border-bottom-width: 2px;">3. INFORMAÇÕES FINANCEIRAS</h3>
            <table class="data-table">
                <tr>
                    <td class="data-label" style="width:35%;">Custo Total:</td>
                    <td style="font-size:18px; font-weight:700; color:#059669;">{{custo}}</td>
                </tr>
            </table>
            
            {{custo_aviso_section}}
            
            <h3 class="section-title" style="margin-top: 40px; border-bottom-width: 2px;">4. AUTORIZAÇÕES</h3>
            <div style="background:#f0f0f0; padding:16px; border-radius:8px; margin:20px 0; font-size:11px; line-height:1.6;">
                <p style="margin:0;">Autorizamos o envio do equipamento acima descrito para diagnóstico e reparo, conforme os termos e condições estabelecidos pela empresa.</p>
            </div>
            
            <div class="signatures" style="margin-top:80px; display:grid; grid-template-columns: repeat(3, 1fr); gap:20px;">
                <div><div class="signature-line" style="height:60px;"></div><p class="signature-name">Gestor</p><p class="signature-role">Autorização</p></div>
                <div><div class="signature-line" style="height:60px;"></div><p class="signature-name">{{operatorName}}</p><p class="signature-role">Responsável Técnico</p></div>
                <div><div class="signature-line" style="height:60px;"></div><p class="signature-name">Testemunha</p><p class="signature-role">Testemunha</p></div>
            </div>
            
            <div class="footer-print" style="margin-top:60px; font-size:10px;">
                <p style="margin:0;">Documento gerado eletronicamente em {{generationTimestamp}}</p>
                <p style="margin:4px 0;">OS: {{numero_os}} | Sistema SMARTCONTROL</p>
            </div>
        </div>
    </template>


    

    <script src="https://unpkg.com/lucide@latest"></script>
    <script type="module" src="{{ url_for('static', filename='js/modules/line_records.js', v='1.4') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/modules/records_form.js', v='1.4') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/modules/records_table.js', v='1.4') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/modules/records.js', v='1.4') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/app.js', v='1.4') }}"></script>

</body>
</html>